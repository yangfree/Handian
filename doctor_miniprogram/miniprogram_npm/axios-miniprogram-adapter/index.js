!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["axios-miniprogram-adapter"]=t()}(this,function(){"use strict";function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var t=Object.prototype.toString;function i(e){return"[object Array]"===t.call(e)}function n(e){return null!==e&&"object"==typeof e}function o(e){return"[object Function]"===t.call(e)}function a(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var u={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===t.call(e)},isBuffer:function(e){return null!=e&&(r(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))||!!e._isBuffer);var t},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:n,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===t.call(e)},isFile:function(e){return"[object File]"===t.call(e)},isBlob:function(e){return"[object Blob]"===t.call(e)},isFunction:o,isStream:function(e){return n(e)&&o(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:a,merge:function r(){var n={};function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]=e}for(var t=0,o=arguments.length;t<o;t++)a(arguments[t],e);return n},extend:function(o,e,i){return a(e,function(e,t){var r,n;o[t]=i&&"function"==typeof e?(r=e,n=i,function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}):e}),o},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},h=function(e,t,r,n,o){var i,a,u,c,f,s=new Error(e);return a=t,u=r,c=n,f=o,(i=s).config=a,u&&(i.code=u),i.request=c,i.response=f,i};function c(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var s="wechat";var l=console.warn;return function(m){var a=function(){switch(!0){case"object"==typeof wx:return s="wechat",wx.request.bind(wx);case"object"==typeof swan:return s="baidu",swan.request.bind(swan);case"object"==typeof my:return s="alipay",(my.request||my.httpRequest).bind(my);default:return wx.request.bind(wx)}}();return new Promise(function(d,p){var t,n=m.data,o=m.headers,y={method:m.method&&m.method.toUpperCase()||"GET",url:function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(u.isURLSearchParams(t))n=t.toString();else{var o=[];u.forEach(t,function(e,t){null!=e&&(u.isArray(e)?t+="[]":e=[e],u.forEach(e,function(e){u.isDate(e)?e=e.toISOString():u.isObject(e)&&(e=JSON.stringify(e)),o.push(c(t)+"="+c(e))}))}),n=o.join("&")}return n&&(e+=(-1===e.indexOf("?")?"?":"&")+n),e}(m.url,m.params,m.paramsSerializer),success:function(e){var t,r,n,o,i,a,u,c,f,s,l=(r=m,n=y,o=(t=e).header||t.headers,i=t.statusCode||t.status,a="",200===i?a="OK":400===i&&(a="Bad Request"),{data:t.data,status:i,statusText:a,headers:o,config:r,request:n});u=d,c=p,s=(f=l).config.validateStatus,f.status&&s&&!s(f.status)?c(h("Request failed with status code "+f.status,f.config,null,f.request,f)):u(f)},fail:function(e){!function(e,t,r){switch(s){case"wechat":-1!==e.errMsg.indexOf("request:fail abort")?t(h("Request aborted",r,"ECONNABORTED","")):-1!==e.errMsg.indexOf("timeout")?t(h("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED","")):t(h("Network Error",r,null,""));break;case"alipay":[14,19].includes(e.error)?t(h("Request aborted",r,"ECONNABORTED","")):[13].includes(e.error)?t(h("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED","")):t(h("Network Error",r,null,""));break;case"baidu":t(h("Network Error",r,null,""))}}(e,p,m)},complete:function(){t=void 0}};if(m.auth){var e=[m.auth.username||"",m.auth.password||""],r=e[0],i=e[1];o.Authorization="Basic "+function(e){for(var t,r,n=String(e),o=0,i=f,a="";n.charAt(0|o)||(i="=",o%1);a+=i.charAt(63&t>>8-o%1*8)){if(255<(r=n.charCodeAt(o+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|r}return a}(r+":"+i)}0!==m.timeout&&l('The "timeout" option is not supported by miniprogram. For more information about usage see "https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#全局配置"'),u.forEach(o,function(e,t){var r=t.toLowerCase();(void 0===n&&"content-type"===r||"referer"===r)&&delete o[t]}),y.header=o,m.responseType&&(y.responseType=m.responseType),m.cancelToken&&m.cancelToken.promise.then(function(e){t&&(t.abort(),p(e),t=void 0)}),function(e){try{return"string"==typeof e&&e.length&&(e=JSON.parse(e))&&"[object Object]"===Object.prototype.toString.call(e)}catch(e){return!1}}(n)&&(n=JSON.parse(n)),void 0!==n&&(y.data=n),t=a(y)})}});
